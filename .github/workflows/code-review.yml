name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize, ready_for_review]
    branches:
      - main-review

permissions:
  contents: read
  pull-requests: write
  id-token: write

jobs:
  code-review:
    if: github.event.pull_request.draft == false
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}

          prompt: |
            code_review_guide.md 파일을 읽고 그 기준에 따라 이 PR을 리뷰해줘.

            리뷰 절차:
            1. PR의 변경된 파일 목록과 diff를 확인
            2. 변경된 각 파일의 전체 내용을 Read로 확인
            3. 변경된 코드가 호출하거나 의존하는 관련 파일도 Grep/Glob으로 탐색
            4. code_review_guide.md의 기준에 따라 리뷰 수행
            5. 반드시 MCP 도구(create_pull_request_review, create_review_comment 등)를 사용하여 PR에 직접 리뷰 코멘트를 작성해라. 텍스트 출력만 하지 마라.
            6. 전체 요약은 create_pull_request_review 도구의 body에 작성해라.

          show_full_output: true
          claude_args: "--model claude-sonnet-4-5-20250929 --max-turns 30"
